---
title: 告别六脉神键，让Vim成为效率利器
date: 2017-06-27 23:34:57
tags:
  - Vim
---

![vim-basic-opration-cover](http://oanr6klwj.bkt.clouddn.com/vim-basic-operation-cover.jpg)
> [*pixiv-ID: 5005427*](https://www.pixiv.net/member_illust.php?mode=medium&illust_id=5005427)

这是[Vim系列教程]()中的一篇，详细的讲述Vim的基础操作。

<!--more-->

何谓六脉神键？话说我有一挚友，有次不得不在服务器上临时调试代码又懒得开SSH，只得打开服务器自带的Vim，一边改代码一边吐槽Vim真难用。于是我就过去围观，发现此君只使用6个键：`h j k l i <Esc>`，因此我调侃他使用Vim时仿佛段公子早期的六脉神剑（键），时灵时不灵。

在工作和生活中，我发现通过六脉神键使用Vim的人不在少数。其实Vim为我们提供了远多于这6个键的编辑方式，掌握它们也不需要费很大功夫，但是能为我们的效率带来很大的提升。

在继续阅读之前，推荐您打开Vim，然后一条一条的尝试体会。

<!-- toc -->

# 1 基本原则

---

使用Vim的过程其实就是不断切换插入模式和普通模式的过程——**插入模式负责输入和修改内容，普通模式负责移动，复制，粘贴和删除**。需要注意的是，普通模式才应该是我们的主角。原因在这里：  
我们可以把Vim的一次次影响文本的操作理解为事务，例如按下一次x删除一个字母就是一次事务。从进入插入模式到退出插入模式也是一次事务。在Vim中，撤销、还原和重复上次修改等操作都是以事务为单元的；因此只有将插入视作一次操作，将普通模式视为“工作模式”，才算是走在了正确的道路上。

# 2 抛弃Esc和方向键

---

当我们离开插入模式或者取消输入了一半的命令时，可能会想到使用`<Esc>`，但是这是不好的。因为`<Esc>`在大多数键盘上离我们手指的默认摆放位置(`f`和`j`)有点远，按下`<Esc>`可能会让我们的手脱离工作区域，花费更多的时间回位，降低效率。

常用的做法是调换一般键盘（不包括特殊键位键盘，例如HHKB）的`Capslock`和`Control\Ctrl`键。然后使用Vim自带的`<C-[>`(就是`Control`+`[`，这种格式后文不再赘述)来代替`<Esc>`键，它们的功能完全相同。

方向键也是同样的道理。它会让我们的右手脱离工作区域，降低效率。因此，想要成为高效Vim使用者的话应该早日习惯使用Vim默认的`kjhl`来分别代替上下左右。

# 3 移动

---

首先，前文已经讲过，上下左右分别对应`kjhl`。  
移动大多数都可以在前面加上`n`来代表重复次数，例如`5l`表示向右移动5个字符，本文将省去这些n，但是读者可以自行尝试体会。

## 3.1 屏幕行与实际行

我们在代码中经常遇到一种情况，就是这行代码还没写完，但是由于写的太长而超过了屏幕所能容纳的大小，代码自动换行了，这时就会出现下图这种情况：

![vim-line](http://oanr6klwj.bkt.clouddn.com/blog/vim-lines.png)

我们注意左边的标注，12就是指实际行，即使前面的11行有3个屏幕行构成，也不会理解实际行的数目。

因此，我们可以这样理解：实际行是假定屏幕无限宽的行数，只有换行符才能让实际行增加；而屏幕行是指屏幕上的行数，它受限于屏幕的宽度而变化。

在Vim中，我们用`j`和`k`来表示下\上移一个实际行，而用`gj`和`gk`来表示下\上移一个屏幕行。

## 3.2 纵向移动

单纯的用`j`和`k`来上移下移 ，当我们需要打开一个很长的代码移到中断进行修改时无疑很不方便。Vim为我们提供了很多整屏移动的方法。

* `HML`
  * `H` 移动到当前屏幕的顶端

  * `M` 移动到当前屏幕的正中间

  * `L` 移动到当前屏幕的底端。
* 行移动

  * `gg` 移动到文件的第一行
  * `G` 移动到文件的最后一行
  * `nG`／`ngg` 移动到文件的第n行
  * `n%` 移动到文件的n%处
  * `+` 移动到下一行行首
  * `-` 移动到上一行行首
* 滚屏
  * `<C-f>` 向下滚动一屏幕

  * `<C-b>` 向上滚动一屏幕

  * `<C-u>` 向上滚动半屏幕

  * `<C-d>` 向下滚动半屏幕
* 移动当前行
  * `zz` 移动当前行到屏幕正中
  * `zt` 移动当前行到屏幕顶端
  * `zb` 移动当前行到屏幕底端
  * `<C-e>` 屏幕向下移动一行
  * `<C-y>` 屏幕向上移动一行


## 3.3 单词移动

* `w` 向后移动到单词的词首
* `b` 向前移动到单词的词首
* `e` 向后移动到单词的词尾
* `ge` 向前移动到单词的词尾


> 当使用大写的`WBE`时，移动无视标点符号


## 3.4 行内移动

* `f` + `x` 跳转到本行下一个*x*处
* `F` + `x` 跳转到本行前一个*x*处
* `t` + `x` 跳转到本行下一个x前
* `T` + `x` 跳转到本行前一个x后
* `;` 重复上次f/t跳转
* `^` 跳转到本行第一个非空字符处
* `0`/`|` 跳转到本行开始处
* `g_` 跳转到本行最后一个非空字符处
* `$` 跳转到本行行末
* `n` + `|` 跳转到本行第n列

## 3.5 查找移动

* `n` 跳转到下一个查找项目
* `N` 跳转到上一个查找项目
* `/`+`xxx` 查找xxx
* `*` 查找下一个光标所在处的单词
* `#` 查找上一个光标所在处的单词
* `:noh` 关闭本次查找高亮

## 3.6 标记移动

标记是Vim中一个很神奇的功能，它能在你需要的地方以某个按键作为标记，你就可以通过这几个按键来进行快速的跳转。

* `:marks` 标记列表
* `m` + `x` 标记当前位置为x
* ``x` 跳转到标记为x的位置
* `'x` 跳转到标记为x的行
* `` ` ` `` 跳转到跳转之前的位置
* `' '` 跳转到跳转之前的行
* ``.` 跳转到最后修改的位置
* `'.` 跳转到最后修改的行

# 4 基本通式

---

Vim在Normal模式下的操作有个基本通式：

$$
最终操作 = 重复次数 * 操作
$$

其中**操作**又有两个公式：

$$
操作=普通操作符 + 操作范围
$$

$$
操作 = 立即执行操作符
$$

下面我来详细解释。

## 4.1 普通操作符

待决定操作符是按下后不会立刻执行的操作符，它还需要用户手动输入范围。常用的有：

* `c` 修改
* `d` 剪切
* `y` 复制
* `g~` 大小写反转
* `gu` 转换为小写
* `gU` 转换为大写
* `>` 增加缩进
* `<` 减小缩进
* `=` 自动缩进

有趣的是，当普通操作符被连续输入两次时，它会作用于当前行，例如`dd`会剪切当前行的内容。

普通操作符之后输入的操作范围非常灵活，可以使用我们在第3节“移动”部分提到的绝大多数操作，例如很多网站提到的：`gg=G` 自动缩进所有代码，其实就是使用`gg`跳转到第1行，然后用`=`操作符确定命令操作为“自动缩进”，然后使用`G`来选定范围为当前位置（第一行）到最后一行。

## 4.2 立即执行操作符

立即执行无法自定义范围，它们一般都自带范围。

* `C` 修改当前至行末
* `D` 剪切当前至行末
* `Y` 复制当前行
* `~` 反转当前位置字符大小写
* `a` 在光标前位置插入
* `A` 在当前行首插入
* `i` 在当前光标后位置插入
* `I` 在当前行尾插入
* `o` 向下插入一行
* `O` 向上插入一行
* `r` 修改当前字符
* `R` 修改至当前行
* `x` 删除当前字符
* `X` 删除当前光标前的字符
* `s` 删除当前字符并插入
* `S` 删除当前行并插入
* `p` 粘贴
* `P` 向前粘贴
* `.` 重复上次修改

# 5 可视模式

---

可视模式是Vim中一个很关键的部分。它的功能有点像我们在普通编辑器中按住鼠标左键拖拽来进行多字符选定。选定后，我们就可以使用操作符来进行操作。

可视模式有三种：

* `v` 进入常规可视模式，通过第3节“移动”部分的内容可以选择选定的内容。

* `V` 进入行可视模式，此时只能以行为单位来进行选择。

* `<C-v` 进入列可视模式，此时可以进行列移动。

  > 列可视模式非常强大，它可以配合`A` `I` 和`d` 等操作符轻松实现多行编辑。



Vim的命令很多，但是如果平时开发中注意多多实践，每当进行重复性操作时就停下想想有没有更方便的办法，便能一点一点让开发速率快起来。